#!/usr/bin/env python
# -*- coding: utf-8 -*-
import os
from pattern.web import *
from pattern.db import *
from Logger import *
logger = setupLogging(__name__)
logger.setLevel(INFO)

def features():
    # Examples
    html = string = u''

    decode_utf8(string)                       # Byte string to Unicode string.
    encode_utf8(string)                       # Unicode string to byte string.
    strip_tags(html, keep=[], replace=blocks) # Non-trivial, using SGML parser.
    strip_between(a, b, string)               # Remove anything between (and including) a and b.
    strip_javascript(html)                    # Strips between '<script*>' and '</script'.
    strip_inline_css(html)                    # Strips between '<style*>' and '</style>'.
    strip_comments(html)                      # Strips between '<!--' and '-->'.
    strip_forms(html)                         # Strips between '<form*>' and '</form>'.
    decode_entities(string)                   # '&lt;' => '<'
    encode_entities(string)                   # '<' => '&lt;'
    decode_url(string)                        # 'and%2For' => 'and/or'
    encode_url(string)                        # 'and/or' => 'and%2For'
    collapse_spaces(string, indentation=False, replace=' ')
    collapse_tabs(string, indentation=False, replace=' ')
    collapse_linebreaks(string, threshold=1)

def getHTML():
    # clips
    # html = URL(u'http://www.clips.ua.ac.be').download()

    # test
    html = u"""<div class="contentLayout2">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<div class="columnMacro" style="width:40%;min-width:40%;max-width:40%;"><div class="panel" style="border-color: green;border-style: solid;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-color: green;color: green;"><b>Project Team</b></div><div class="panelContent">
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Key Role</th><th colspan="1" class="confluenceTh"> Executive Contact</th><th class="confluenceTh">Assigned Resource*</th></tr><tr><th class="confluenceTh">Business Sponsor</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> <span>Kristin Zarama</span></td></tr><tr><th class="confluenceTh">Solution Architect</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> <span>Gregory Stewart</span></td></tr><tr><th class="confluenceTh">Program Manager</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> </td></tr><tr><th class="confluenceTh">Technology Project Manager</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> </td></tr><tr><th class="confluenceTh">Business Project Manager</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> </td></tr><tr><th class="confluenceTh">Development Technical Lead</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd"> </td></tr></tbody></table></div>
</div></div><p>  * Solution Engineering Tech Note : </p><p>      Please update <a href="/display/SolEng/Estimation+and+Solution+Points+of+Contact">Estimation and Solution Points of Contact</a></p><p>      Use  <a href="https://rostr.disney.com/" class="external-link" rel="nofollow">Disney Rostr+</a> to lookup contacts</p></div><div class="columnMacro" style="width:10%;min-width:10%;max-width:10%;"> </div><div class="columnMacro" style="width:40%;min-width:40%;max-width:40%;"><div class="panel" style="border-color: green;border-style: solid;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-color: green;color: green;"><b>Project Timing &amp; Cost</b></div><div class="panelContent">
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Summary Information</th><th class="confluenceTh"><p>Date (MM/YY/YYYY) &amp; Funding (in $M) Date</p></th></tr><tr><td class="confluenceTd">Estimated Development Start</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Estimated Development End</td><td class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Estimated Production Launch</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Total ROM Estimate</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Total Scope Estimate</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Project Budget</td><td class="confluenceTd"> </td></tr></tbody></table></div>
</div></div></div><p> </p><p> </p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h4 id="TableDelivery-DocumentRepository"><strong><span style="color: rgb(51,153,102);">Document Repository</span></strong></h4><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Document Title </th><th colspan="1" class="confluenceTh">Owner </th><th colspan="1" style="text-align: center;" class="confluenceTh">Timing for final output</th><th class="confluenceTh">Link to File </th></tr><tr><td class="confluenceTd">ROM Deck (sys context, bus context)</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">1 ROM</td><td class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Infrastructure Estimate @ ROM</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">1 ROM</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Solution Engineering Design Estimate (Package @ ROM)</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">1 ROM</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Security Requirements Document</td><td class="confluenceTd">WDPPRT Security &amp; Compliance</td><td class="confluenceTd">1 ROM</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Scope Deck (Soln Overview, Assumptions, Cost, Risk, Final sys and bus context)</td><td class="confluenceTd">Solution Engineering</td><td class="confluenceTd">2 Scope</td><td class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Business case / idea (User Stories, etc)</td><td colspan="1" class="confluenceTd">Business PM</td><td colspan="1" class="confluenceTd">2 Scope</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Infrastructure Estimate (@ Scope)</td><td colspan="1" class="confluenceTd">DTSS infrastructure Design</td><td colspan="1" class="confluenceTd">2 Scope</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Design - Application Infrastructure Diagram (AID)</td><td class="confluenceTd">DTSS infrastructure Design </td><td class="confluenceTd">2 Scope</td><td class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Project Workbook</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">2 Scope</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Populated Project Request - Agile</td><td colspan="1" class="confluenceTd">Technology PM</td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Populated Project Request - Version 1</td><td colspan="1" class="confluenceTd">Technology PM</td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Agile Engagement Training Plan</td><td colspan="1" class="confluenceTd">Agile Tools Team </td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Agility Assessment</td><td colspan="1" class="confluenceTd">Agile Coaching Team</td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Agility Roadmap</td><td colspan="1" class="confluenceTd">Agile Coaching Team </td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Final Funding Package (@ Signature)</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">3 Routing for Funds</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Volume Metrics</td><td class="confluenceTd">Technology PM </td><td class="confluenceTd">3 Routing for Funds</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Detailed Design Specs (Application and Technology Stack)</td><td class="confluenceTd">Solution Engineering </td><td class="confluenceTd">3 Routing for Funds</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Detailed Design Specs (Infrastructure)</td><td class="confluenceTd">DTSS infrastructure Design </td><td class="confluenceTd">3 Routing for Funds </td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Infra Monitoring Design</td><td class="confluenceTd">Service Availability L2AO</td><td class="confluenceTd">3 Routing for Funds  </td><td class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Sequence Diagrams</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">4 Funded / Active </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Deployment Diagrams</td><td colspan="1" class="confluenceTd">Solution Engineering</td><td colspan="1" class="confluenceTd">4 Funded / Active </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Server Build Docs (Summary of environments)</td><td colspan="1" class="confluenceTd">Infrastructure Delivery Office </td><td colspan="1" class="confluenceTd">4 Funded / Active </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Network Build Doc</td><td colspan="1" class="confluenceTd">System Engineering (SE Core)</td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Final Infrastructure Configuration - As Built AID</td><td colspan="1" class="confluenceTd">System Engineering (SE Core)</td><td colspan="1" class="confluenceTd">4 Funded / Active </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Server Turnover Docs</td><td colspan="1" class="confluenceTd">Infrastructure Delivery Office </td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Completed CICD Tech Assessment</td><td colspan="1" class="confluenceTd">Adv. Shared Capabilities - CI/CD  </td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">AsBuilt CICD Summary</td><td colspan="1" class="confluenceTd">Adv. Shared Capabilities - CI/CD </td><td colspan="1" class="confluenceTd">4 Funded / Active </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Load Balancing + iRule Specification</td><td colspan="1" class="confluenceTd">System Engineering (SE Core) </td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Security Assessment Report</td><td colspan="1" class="confluenceTd">WDPRT Security &amp; Compliance</td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Security Penetration Test Report</td><td colspan="1" class="confluenceTd">WDPRT Security &amp; Compliance</td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Final Monitoring Config - As built spec</td><td colspan="1" class="confluenceTd">Service Availability L2AO</td><td colspan="1" class="confluenceTd">4 Funded / Active  </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><em>User specified documents use this line and below</em></td><td colspan="1" class="confluenceTd"> TBD</td><td colspan="1" class="confluenceTd"> # Phase</td><td colspan="1" class="confluenceTd"> </td></tr></tbody></table></div><p> </p><p> </p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" style="text-align: right;" class="confluenceTh">Business Liaison</th><td colspan="1" class="confluenceTd">Rhian Chapman</td></tr><tr><th style="text-align: right;" class="confluenceTh"> Business Sponsor</th><td class="confluenceTd">Kristin Zarama</td></tr></tbody></table></div><p> </p><p> </p><p><strong><u>1. Overview</u></strong></p><p>Improve Guests’ QSR dining experience by delivering their meal to the table or to their location</p><p><span><span style="color: rgb(0,0,0);">Business Goals</span></span></p><div class="O0" style="margin-left: 30.0px;">•Enables a relaxing dining experience by Guests not having to maneuver through congested servery to pick-up trays of food</div><div class="O0" style="margin-left: 30.0px;">•Families stay together rather than some members holding a table while others are waiting at the window for their meal</div><div class="O0" style="margin-left: 30.0px;">•Preserves food quality and temperature</div><div class="O0" style="margin-left: 30.0px;">•Exceeds Guests’ expectations and positions Disney Food &amp; Beverage with or ahead of the industry</div><p><span><span style="color: rgb(0,0,0);"> </span></span></p><p><u><strong>2. Scope (and out of Scope)</strong></u></p><p style="margin-left: 60.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Deliver Guests order to table  - see epics</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Deliver Guests order to where they are standing/sitting (To-Go Orders) – see epics</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Enterprise Integration</div><div class="O0" style="margin-left: 60.0px;"><span style="line-height: 1.42857;">Integration and not a stand alone system</span></div><div class="O1" style="margin-left: 60.0px;">Potential to integrate with future initiatives (Mobile Order &amp; Pick Up)</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Bi-directional communication<span style="color: rgb(0,0,0);"> </span></div><div class="O1" style="margin-left: 60.0px;">System can interact with the puck</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Network integration</div><div class="O1" style="margin-left: 60.0px;">Broad availability of hardware protocols</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Audio Interactivity</div><div class="O1" style="margin-left: 60.0px;">Enhance system interaction and show elements</div><div class="O1" style="margin-left: 60.0px;">Message to the puck</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Light interactivity</div><div class="O1" style="margin-left: 60.0px;">Enhance system interaction and show elements<span style="color: rgb(0,0,0);"> </span></div><div class="O1" style="margin-left: 60.0px;">Message to the puck</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Customizable Puck</div><div class="O1" style="margin-left: 60.0px;">Graphics on puck (base need)<span style="color: rgb(0,0,0);"> </span></div><div class="O1" style="margin-left: 60.0px;">Treatment of puck casing (don’t need for base estimate)</div><p style="margin-left: 90.0px;"><span style="color: rgb(0,0,0);"> </span></p><div class="O0" style="margin-left: 30.0px;">Customized User Interface</div><div class="O1" style="margin-left: 60.0px;">Cast Member select order and indicate as in route, delivery completed, can’t find Guest</div><p style="margin-left: 60.0px;"><span style="color: rgb(0,0,0);"><span><span><span><br></span></span></span></span></p><h4 id="TableDelivery-3.SolutionProposal(w/Assumptions/Risk)"><u>3. Solution Proposal (w/ Assumptions/Risk)</u></h4><p style="margin-left: 30.0px;">POS</p><p style="margin-left: 60.0px;">Cast enters the puck id into the order as the table number.</p><p style="margin-left: 60.0px;">No technical changes.</p><p style="margin-left: 30.0px;">KDS</p><p style="margin-left: 60.0px;">Cast bumps orders from KDS as normal.</p><p style="margin-left: 60.0px;">Service exposed to retrieve all bumped orders.</p><p style="margin-left: 60.0px;">Service exposed to bump orders back to KDS.</p><p style="margin-left: 30.0px;">Table Delivery Services</p><p style="margin-left: 60.0px;">Services</p><p style="margin-left: 90.0px;">Retrieve list of bumped orders.</p><p style="margin-left: 120.0px;">Integrates with KDS</p><p style="margin-left: 90.0px;"><span style="color: rgb(255,153,0);">Retrieve location of guest / puck.</span></p><p style="margin-left: 120.0px;"><span style="color: rgb(255,153,0);">Integrates with Radius</span></p><p style="margin-left: 90.0px;">Claim order.</p><p style="margin-left: 90.0px;">Complete order.</p><p style="margin-left: 90.0px;">Bump order back to KDS</p><p style="margin-left: 30.0px;">Table Delivery UI</p><p style="margin-left: 60.0px;">Views</p><p style="margin-left: 90.0px;">List of orders ready for delivery</p><p style="margin-left: 90.0px;">List of active pucks.</p><p style="margin-left: 90.0px;">Reporting. History of deliveries for the day.</p><p style="margin-left: 30.0px;">Radius Services</p><p style="margin-left: 30.0px;">Hardware</p><p style="margin-left: 30.0px;">Location Beacon</p><h4 id="TableDelivery-4.ProjectDocuments"><u>4. Project Documents</u></h4><h5 style="margin-left: 30.0px;" id="TableDelivery-Concept/ContextDiagram">Concept / Context Diagram</h5><p style="margin-left: 60.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="/download/attachments/221594416/TableDeliveryContext.png?version=1&amp;modificationDate=1446130433602&amp;api=v2" data-image-src="/download/attachments/221594416/TableDeliveryContext.png?version=1&amp;modificationDate=1446130433602&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="221594414" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="TableDeliveryContext.png" data-base-url="https://confluence.disney.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="221594416" data-linked-resource-container-version="4"></span></p><h5 style="margin-left: 30.0px;" id="TableDelivery-Externaldocuments">External documents</h5><p style="margin-left: 60.0px;">EPICS:</p><p style="margin-left: 60.0px;"><span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="/download/attachments/221594416/Table%20Delivery%20Epics_User%20Stories.docx?version=1&amp;modificationDate=1446130433626&amp;api=v2" data-nice-type="Word Document" data-file-src="/download/attachments/221594416/Table%20Delivery%20Epics_User%20Stories.docx?version=1&amp;modificationDate=1446130433626&amp;api=v2" data-linked-resource-id="221594412" data-linked-resource-type="attachment" data-linked-resource-container-id="221594416" data-linked-resource-default-alias="Table Delivery Epics_User Stories.docx" data-mime-type="application/vnd.openxmlformats-officedocument.wordprocessingml.document" data-has-thumbnail="true" data-linked-resource-version="1"><img src="/rest/documentConversion/latest/conversion/thumbnail/221594412/1" height="250"></a></span></p></div>
</div>
</div>
</div>"""

    return html

def h2p():
    # plaintext = strip + decode + collapse

    html = getHTML()
    s = plaintext(html, keep={u'h1':[], u'h2':[], u'strong':[], u'a':[u'href']})
    logger.info(u"PT [%s]" % s)

if __name__ == u"__main__":
    h2p()
